# Deep Neural Network (DNN) Profiler

This project provides a set of tools for profiling the execution time and energy consumption of deep learning operations and ONNX models.
It supports both CPU and GPU (CUDA) backends and allows profiling either at the per-operation level or across all operators in a full ONNX model.

## 📂 Repository Structure

**-per_op_profiler.py**
Profiles a single PyTorch operation (e.g., ReLU, Sigmoid, Tanh, MatMul) across multiple runs.
Reports average execution time, power usage, and energy consumption.

**-network_profiler.py**
Loads an ONNX model and runs per-operation profiling for each node in the computational graph.
Results are aggregated and exported to CSV.

**-op_parser.py**
Utility script to inspect an ONNX model. Prints model metadata, input/output details, and performs a test inference using ONNX Runtime.

**-rand_model.py**
Exports a pretrained ResNet18 model from PyTorch to ONNX format for testing.

**-requirements.txt**
Python package dependencies required to run the profilers.

**-network_profile.csv**
Example output CSV showing profiling results from network_profiler.py.

**-model.onnx**
Example ONNX model generated by rand_model.py.

## ⚙️ Installation

**1. Clone the repository:** git clone https://github.com/HibaAmmissa03/dnn_profiler
cd dnn-profiler

**2. Install Python dependencies:**
pip install -r requirements.txt

**3. (Linux only) Install CPU energy measurement tools:**
sudo apt install msr-tools
sudo modprobe msr

## 🚀 Usage

### 1. Per-Operation Profiler (per_op_profiler.py)
   
Profiles a single operator (e.g., ReLU, Sigmoid, Tanh, MatMul) on CPU or GPU.
Supports measurement of execution time and energy consumption.

**--> Command to run:**
python per_op_profiler.py \
  --op relu \
  --input-shape 1 3 224 224 \
  --dtype float32 \
  --device cuda \
  --runs 10 \
  --csv results.csv

**--> Arguments:**
--op : Operation type (relu, sigmoid, tanh, matmul)
--input-shape : Input tensor dimensions (e.g., 1 3 224 224)
--dtype : Precision (float32, float64, float16, bfloat16, int32, int64)
--device : Execution device (cpu or cuda)
--runs : Number of repetitions for averaging (default: 10)
--csv : Output CSV file name (default: profiler_results.csv)

### 2. Network Profiler (network_profiler.py)

Profiles all operations in an ONNX model using per_op_profiler internally.
Results are written to a CSV file with per-operator statistics.

**--> Command to run:**
python network_profiler.py \
  --model model.onnx \
  --device cpu \
  --runs 10 \
  --csv network_profile.csv \
  --dtype float32

**--> Arguments:**
--model : Path to ONNX model file
--device : Execution device (cpu or cuda)
--runs : Number of repetitions for averaging (default: 10)
--csv : Output CSV file (default: network_per_op_results.csv)
--dtype : Precision for tensors (default: float32)

## 📊 Example Workflow:

1. Export a model to ONNX: python rand_model.py
2. Parse and inspect it: python op_parser.py
3. Profile the model per operation: python network_profiler.py --model model.onnx --device cpu --runs 20 --csv network_profile.csv
4. Profile a single operation: python per_op_profiler.py --op matmul --input-shape 512 512 --device cuda --runs 50


## 📦 Requirements: All dependencies are listed in requirements.txt:

torch>=2.0.0
onnx>=1.15.0
onnxruntime>=1.15.0
numpy>=1.25.0
pandas>=2.1.0
pyRAPL>=0.12.0

--> pip install -r requirements.txt
   
